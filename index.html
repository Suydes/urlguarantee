<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Legends Market</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --accent-color: #ff9500;
            --error-color: #e53935;
            --success-color: #43a047;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent-color);
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tab.active {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }

        .content {
            display: none;
        }

        .content.active {
            display: block;
        }

        .card {
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .card-title {
            font-weight: bold;
        }

        .card-date {
            color: var(--tg-theme-hint-color);
            font-size: 12px;
        }

        .card-content {
            margin-bottom: 12px;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .button {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .button:hover {
            opacity: 0.9;
        }

        .button-secondary {
            background-color: transparent;
            color: var(--tg-theme-button-color);
            border: 1px solid var(--tg-theme-button-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--tg-theme-button-color);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .image-upload {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .image-preview {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-add {
            border: 1px dashed rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tg-theme-hint-color);
        }

        .image-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            cursor: pointer;
        }

        .counter {
            text-align: right;
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            margin-top: 4px;
        }

        .guarantor-card {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            background-color: rgba(0, 0, 0, 0.02);
            margin-bottom: 12px;
        }

        .guarantor-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--tg-theme-button-color);
        }

        .guarantor-info {
            flex: 1;
        }

        .guarantor-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .guarantor-username {
            color: var(--tg-theme-link-color);
            margin-bottom: 4px;
            font-size: 14px;
        }

        .rating {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .star {
            color: #ffd700;
            margin-right: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: var(--tg-theme-hint-color);
        }

        .empty-state-icon {
            font-size: 40px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 16px;
        }

        .alert {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .alert-success {
            background-color: rgba(67, 160, 71, 0.1);
            color: var(--success-color);
        }

        .alert-error {
            background-color: rgba(229, 57, 53, 0.1);
            color: var(--error-color);
        }

        .image-gallery {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .gallery-image {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .gallery-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--tg-theme-button-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">Mobile Legends Market</div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="sell">–ü—Ä–æ–¥–∞—é</div>
            <div class="tab" data-tab="buy">–ò—â—É –∞–∫–∫–∞—É–Ω—Ç</div>
            <div class="tab" data-tab="guarantors">–ì–∞—Ä–∞–Ω—Ç—ã</div>
        </div>

        <div class="content active" id="sell-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</div>
                </div>
                <div class="card-content">
                    <form id="sell-form">
                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</label>
                            <textarea class="form-control" id="sell-description" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç, —É–∫–∞–∂–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å, —Å–∫–∏–Ω—ã, –≥–µ—Ä–æ–µ–≤ –∏ –¥—Ä—É–≥–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏..." maxlength="1000"></textarea>
                            <div class="counter"><span id="char-count">0</span>/1000</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–°–∫—Ä–∏–Ω—à–æ—Ç—ã (–º–∞–∫—Å–∏–º—É–º 3)</label>
                            <div class="image-upload" id="image-upload-container">
                                <div class="image-preview image-preview-add" id="add-image">
                                    <span>+</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–¶–µ–Ω–∞ (–≤ —Ä—É–±–ª—è—Ö)</label>
                            <input type="number" class="form-control" id="sell-price" placeholder="–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</label>
                            <input type="text" class="form-control" id="sell-contact" placeholder="–í–∞—à –Ω–∏–∫ –≤ Telegram">
                        </div>
                        <button type="submit" class="button" id="submit-sell">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
                </div>
                <div class="card-content" id="listings-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content" id="buy-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∫—É–ø–∫—É</div>
                </div>
                <div class="card-content">
                    <form id="buy-form">
                        <div class="form-group">
                            <label class="form-label">–ß—Ç–æ –≤—ã –∏—â–µ—Ç–µ?</label>
                            <textarea class="form-control" id="buy-description" placeholder="–û–ø–∏—à–∏—Ç–µ –∫–∞–∫–æ–π –∞–∫–∫–∞—É–Ω—Ç –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏, —É–∫–∞–∂–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É—Ä–æ–≤–Ω—é, —Å–∫–∏–Ω–∞–º, –≥–µ—Ä–æ—è–º –∏ –¥—Ä—É–≥–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º..." maxlength="1000"></textarea>
                            <div class="counter"><span id="buy-char-count">0</span>/1000</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ë—é–¥–∂–µ—Ç (–≤ —Ä—É–±–ª—è—Ö)</label>
                            <input type="number" class="form-control" id="buy-price" placeholder="–£–∫–∞–∂–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</label>
                            <input type="text" class="form-control" id="buy-contact" placeholder="–í–∞—à –Ω–∏–∫ –≤ Telegram">
                        </div>
                        <button type="submit" class="button" id="submit-buy">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å</button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</div>
                </div>
                <div class="card-content" id="requests-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content" id="guarantors-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç—ã</div>
                </div>
                <div class="card-content" id="guarantors-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        let selectedImages = [];
        let listings = [];
        let requests = [];
        let guarantors = [];
        let currentUser = null;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // –ü–æ–∫–∞–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabName}-content`).classList.add('active');
            });
        });

        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
        document.getElementById('sell-description').addEventListener('input', function() {
            const charCount = this.value.length;
            document.getElementById('char-count').textContent = charCount;
            
            if (charCount > 1000) {
                this.value = this.value.substring(0, 1000);
                document.getElementById('char-count').textContent = 1000;
            }
        });

        document.getElementById('buy-description').addEventListener('input', function() {
            const charCount = this.value.length;
            document.getElementById('buy-char-count').textContent = charCount;
            
            if (charCount > 1000) {
                this.value = this.value.substring(0, 1000);
                document.getElementById('buy-char-count').textContent = 1000;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        document.getElementById('add-image').addEventListener('click', function() {
            if (selectedImages.length >= 3) {
                showAlert('–ú–∞–∫—Å–∏–º—É–º 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);
            
            fileInput.click();
            
            fileInput.addEventListener('change', function() {
                if (fileInput.files && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    
                    if (file.size > 5 * 1024 * 1024) { // 5MB
                        showAlert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä - 5MB', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        addImagePreview(imageData);
                        selectedImages.push(imageData);
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        if (selectedImages.length >= 3) {
                            document.getElementById('add-image').style.display = 'none';
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
                
                document.body.removeChild(fileInput);
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function addImagePreview(imageData) {
            const imageContainer = document.createElement('div');
            imageContainer.className = 'image-preview';
            
            const image = document.createElement('img');
            image.src = imageData;
            
            const removeButton = document.createElement('div');
            removeButton.className = 'image-preview-remove';
            removeButton.textContent = '√ó';
            
            removeButton.addEventListener('click', function() {
                const index = selectedImages.indexOf(imageData);
                if (index > -1) {
                    selectedImages.splice(index, 1);
                }
                
                imageContainer.remove();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–µ–Ω—å—à–µ 3
                if (selectedImages.length < 3) {
                    document.getElementById('add-image').style.display = 'flex';
                }
            });
            
            imageContainer.appendChild(image);
            imageContainer.appendChild(removeButton);
            
            document.getElementById('image-upload-container').insertBefore(imageContainer, document.getElementById('add-image'));
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        document.getElementById('sell-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const description = document.getElementById('sell-description').value.trim();
            const price = document.getElementById('sell-price').value.trim();
            const contact = document.getElementById('sell-contact').value.trim();
            
            if (!description) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞', 'error');
                return;
            }
            
            if (!price) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É', 'error');
                return;
            }
            
            if (!contact) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏', 'error');
                return;
            }
            
            const formData = {
                action: 'create_listing',
                text: `${description}\n\n–¶–µ–Ω–∞: ${price} —Ä—É–±.\n–ö–æ–Ω—Ç–∞–∫—Ç—ã: ${contact}`,
                images: selectedImages
            };
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
            tg.sendData(JSON.stringify(formData));
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('sell-form').reset();
            document.getElementById('char-count').textContent = '0';
            selectedImages = [];
            const imageContainer = document.getElementById('image-upload-container');
            const imagePreviews = imageContainer.querySelectorAll('.image-preview:not(.image-preview-add)');
            imagePreviews.forEach(preview => preview.remove());
            document.getElementById('add-image').style.display = 'flex';
            
            showAlert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é', 'success');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É
        document.getElementById('buy-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const description = document.getElementById('buy-description').value.trim();
            const price = document.getElementById('buy-price').value.trim();
            const contact = document.getElementById('buy-contact').value.trim();
            
            if (!description) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ', 'error');
                return;
            }
            
            if (!price) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –±—é–¥–∂–µ—Ç', 'error');
                return;
            }
            
            if (!contact) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏', 'error');
                return;
            }
            
            const formData = {
                action: 'create_request',
                text: `${description}\n\n–ë—é–¥–∂–µ—Ç: ${price} —Ä—É–±.\n–ö–æ–Ω—Ç–∞–∫—Ç—ã: ${contact}`
            };
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
            tg.sendData(JSON.stringify(formData));
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('buy-form').reset();
            document.getElementById('buy-char-count').textContent = '0';
            
            showAlert('–ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 'success');
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showAlert(message, type) {
            const alertElement = document.createElement('div');
            alertElement.className = `alert alert-${type}`;
            alertElement.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertElement, container.firstChild);
            
            setTimeout(() => {
                alertElement.remove();
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        function renderListings(listings) {
            const container = document.getElementById('listings-container');
            container.innerHTML = '';
            
            if (!listings || listings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div class="empty-state-text">–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                        <button class="button button-secondary">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                    </div>
                `;
                return;
            }
            
            listings.forEach(listing => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const cardHeader = document.createElement('div');
                cardHeader.className = 'card-header';
                
                const cardTitle = document.createElement('div');
                cardTitle.className = 'card-title';
                cardTitle.textContent = `–ê–∫–∫–∞—É–Ω—Ç –æ—Ç ${listing.username}`;
                
                const cardDate = document.createElement('div');
                cardDate.className = 'card-date';
                cardDate.textContent = listing.date;
                
                cardHeader.appendChild(cardTitle);
                cardHeader.appendChild(cardDate);
                
                const cardContent = document.createElement('div');
                cardContent.className = 'card-content';
                cardContent.textContent = listing.text;
                
                if (listing.images && listing.images.length > 0) {
                    const imageGallery = document.createElement('div');
                    imageGallery.className = 'image-gallery';
                    
                    listing.images.forEach(image => {
                        const galleryImage = document.createElement('div');
                        galleryImage.className = 'gallery-image';
                        
                        const img = document.createElement('img');
                        img.src = image;
                        
                        galleryImage.appendChild(img);
                        imageGallery.appendChild(galleryImage);
                    });
                    
                    cardContent.appendChild(imageGallery);
                }
                
                const cardFooter = document.createElement('div');
                cardFooter.className = 'card-footer';
                
                const contactButton = document.createElement('button');
                contactButton.className = 'button';
                contactButton.textContent = '–°–≤—è–∑–∞—Ç—å—Å—è';
                
                cardFooter.appendChild(contactButton);
                
                card.appendChild(cardHeader);
                card.appendChild(cardContent);
                card.appendChild(cardFooter);
                
                container.appendChild(card);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–∫—É–ø–∫—É
        function renderRequests(requests) {
            const container = document.getElementById('requests-container');
            container.innerHTML = '';
            
            if (!requests || requests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">–ó–∞–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                        <button class="button button-secondary">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å</button>
                    </div>
                `;
                return;
            }
            
            requests.forEach(request => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const cardHeader = document.createElement('div');
                cardHeader.className = 'card-header';
                
                const cardTitle = document.createElement('div');
                cardTitle.className = 'card-title';
                cardTitle.textContent = `–ó–∞–ø—Ä–æ—Å –æ—Ç ${request.username}`;
                
                const cardDate = document.createElement('div');
                cardDate.className = 'card-date';
                cardDate.textContent = request.date;
                
                cardHeader.appendChild(cardTitle);
                cardHeader.appendChild(cardDate);
                
                const cardContent = document.createElement('div');
                cardContent.className = 'card-content';
                cardContent.textContent = request.text;
                
                const cardFooter = document.createElement('div');
                cardFooter.className = 'card-footer';
                
                const contactButton = document.createElement('button');
                contactButton.className = 'button';
                contactButton.textContent = '–°–≤—è–∑–∞—Ç—å—Å—è';
                
                cardFooter.appendChild(contactButton);
                
                card.appendChild(cardHeader);
                card.appendChild(cardContent);
                card.appendChild(cardFooter);
                
                container.appendChild(card);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–æ–≤
        function renderGuarantors(guarantors) {
            const container = document.getElementById('guarantors-container');
            container.innerHTML = '';
            
            if (!guarantors || guarantors.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõ°Ô∏è</div>
                        <div class="empty-state-text">–ì–∞—Ä–∞–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                        <div class="empty-state-text">–°–ø–∏—Å–æ–∫ –≥–∞—Ä–∞–Ω—Ç–æ–≤ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω</div>
                    </div>
                `;
                return;
            }
            
            guarantors.forEach(guarantor => {
                const card = document.createElement('div');
                card.className = 'guarantor-card';
                
                const avatar = document.createElement('div');
                avatar.className = 'guarantor-avatar';
                avatar.textContent = guarantor.name.charAt(0);
                
                const info = document.createElement('div');
                info.className = 'guarantor-info';
                
                const name = document.createElement('div');
                name.className = 'guarantor-name';
                name.textContent = guarantor.name;
                
                const username = document.createElement('div');
                username.className = 'guarantor-username';
                username.textContent = `@${guarantor.username}`;
                
                const rating = document.createElement('div');
                rating.className = 'rating';
                
                // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥—ã —Ä–µ–π—Ç–∏–Ω–≥–∞
                for (let i = 0; i < 5; i++) {
                    const star = document.createElement('span');
                    star.className = 'star';
                    star.textContent = i < guarantor.rating ? '‚òÖ' : '‚òÜ';
                    rating.appendChild(star);
                }
                
                const contacts = document.createElement('div');
                contacts.className = 'guarantor-contacts';
                contacts.textContent = guarantor.contacts;
                
                info.appendChild(name);
                info.appendChild(username);
                info.appendChild(rating);
                info.appendChild(contacts);
                
                card.appendChild(avatar);
                card.appendChild(info);
                
                container.appendChild(card);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É)
        function loadData() {
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            setTimeout(() => {
                // –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                listings = [
                    {
                        id: '1',
                        username: 'user123',
                        date: '2025-03-17',
                        text: '–ü—Ä–æ–¥–∞–º –∞–∫–∫–∞—É–Ω—Ç Mobile Legends. –£—Ä–æ–≤–µ–Ω—å 120, 80 –≥–µ—Ä–æ–µ–≤, 35 —Å–∫–∏–Ω–æ–≤. –†–∞–Ω–≥: –ú–∏—Ñ–∏—á–µ—Å–∫–∏–π 1. –≠–º–±–ª–µ–º—ã: 60+. –ë–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏.\n\n–¶–µ–Ω–∞: 15000 —Ä—É–±.\n–ö–æ–Ω—Ç–∞–∫—Ç—ã: @user123',
                        images: []
                    },
                    {
                        id: '2',
                        username: 'gamer456',
                        date: '2025-03-16',
                        text: '–ü—Ä–æ–¥–∞–º –∞–∫–∫–∞—É–Ω—Ç —Å —Ä–µ–¥–∫–∏–º–∏ —Å–∫–∏–Ω–∞–º–∏. 70 –≥–µ—Ä–æ–µ–≤,
                        {
                        id: '2',
                        username: 'gamer456',
                        date: '2025-03-16',
                        text: '–ü—Ä–æ–¥–∞–º –∞–∫–∫–∞—É–Ω—Ç —Å —Ä–µ–¥–∫–∏–º–∏ —Å–∫–∏–Ω–∞–º–∏. 70 –≥–µ—Ä–æ–µ–≤, 40 —Å–∫–∏–Ω–æ–≤ –≤–∫–ª—é—á–∞—è —ç–ø–∏—á–µ—Å–∫–∏–µ –∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ. –†–∞–Ω–≥: –ú–∏—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ—á–µ—Ç. –≠–º–±–ª–µ–º—ã –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ.\n\n–¶–µ–Ω–∞: 25000 —Ä—É–±.\n–ö–æ–Ω—Ç–∞–∫—Ç—ã: @gamer456',
                        images: []
                    }
                ];
                
                requests = [
                    {
                        id: '1',
                        username: 'buyer789',
                        date: '2025-03-18',
                        text: '–ö—É–ø–ª—é –∞–∫–∫–∞—É–Ω—Ç —Å –≥–µ—Ä–æ—è–º–∏ –¥–ª—è —Ä–∞–Ω–≥–æ–≤—ã—Ö –∏–≥—Ä. –ù—É–∂–Ω—ã –º–∏–Ω–∏–º—É–º 30 –≥–µ—Ä–æ–µ–≤ –∏ —Ö–æ—Ç—è –±—ã 10 —Å–∫–∏–Ω–æ–≤. –í–∞–∂–Ω–æ –Ω–∞–ª–∏—á–∏–µ —ç–º–±–ª–µ–º 50+.\n\n–ë—é–¥–∂–µ—Ç: 10000 —Ä—É–±.\n–ö–æ–Ω—Ç–∞–∫—Ç—ã: @buyer789'
                    },
                    {
                        id: '2',
                        username: 'mlplayer',
                        date: '2025-03-15',
                        text: '–ò—â—É –∞–∫–∫–∞—É–Ω—Ç –º–∏—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–Ω–≥–∞ —Å —Ä–µ–¥–∫–∏–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–∫–∏–Ω–∞–º–∏. –ì–æ—Ç–æ–≤ —Ö–æ—Ä–æ—à–æ –∑–∞–ø–ª–∞—Ç–∏—Ç—å –∑–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.\n\n–ë—é–¥–∂–µ—Ç: 30000 —Ä—É–±.\n–ö–æ–Ω—Ç–∞–∫—Ç—ã: @mlplayer'
                    }
                ];
                
                guarantors = [
                    {
                        id: '1',
                        name: '–ê–ª–µ–∫—Å–µ–π',
                        username: 'alex_guarantor',
                        rating: 5,
                        contacts: 'Telegram: @alex_guarantor',
                        transactions: 183
                    },
                    {
                        id: '2',
                        name: '–ú–∞—Ä–∏—è',
                        username: 'maria_safe',
                        rating: 4,
                        contacts: 'Telegram: @maria_safe',
                        transactions: 95
                    }
                ];
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                renderListings(listings);
                renderRequests(requests);
                renderGuarantors(guarantors);
            }, 1000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                currentUser = tg.initDataUnsafe.user;
                // –ú–æ–∂–Ω–æ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userContact = `@${currentUser.username || ''}`;
                
                document.getElementById('sell-contact').value = userContact;
                document.getElementById('buy-contact').value = userContact;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏—è—Ö –∏ –∑–∞–ø—Ä–æ—Å–∞—Ö
        document.addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('button') && e.target.textContent === '–°–≤—è–∑–∞—Ç—å—Å—è') {
                // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                const card = e.target.closest('.card');
                if (!card) return;
                
                // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const cardContent = card.querySelector('.card-content');
                if (!cardContent) return;
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã (–æ–±—ã—á–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ)
                const text = cardContent.textContent;
                const contactMatch = text.match(/–ö–æ–Ω—Ç–∞–∫—Ç—ã:\s+(@[\w\d_]+)/i);
                
                if (contactMatch && contactMatch[1]) {
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ Telegram
                    const username = contactMatch[1].substring(1); // –£–¥–∞–ª—è–µ–º —Å–∏–º–≤–æ–ª @
                    tg.openTelegramLink(`https://t.me/${username}`);
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
        document.addEventListener('click', function(e) {
            if (e.target && e.target.tagName === 'IMG' && e.target.closest('.gallery-image')) {
                const img = e.target;
                const src = img.src;
                
                // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                const modal = document.createElement('div');
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.backgroundColor = 'rgba(0, 0, 0, 0.9)';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                modal.style.zIndex = '1000';
                
                const modalImg = document.createElement('img');
                modalImg.src = src;
                modalImg.style.maxWidth = '90%';
                modalImg.style.maxHeight = '90%';
                modalImg.style.objectFit = 'contain';
                
                modal.appendChild(modalImg);
                document.body.appendChild(modal);
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
                modal.addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –≤ –ø—É—Å—Ç—ã—Ö —Å–ø–∏—Å–∫–∞—Ö
        document.addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('button-secondary')) {
                const buttonText = e.target.textContent;
                
                if (buttonText === '–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ') {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–æ–¥–∞–∂–∏
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.tab[data-tab="sell"]').classList.add('active');
                    
                    document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
                    document.getElementById('sell-content').classList.add('active');
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
                    document.getElementById('sell-form').scrollIntoView({ behavior: 'smooth' });
                }
                
                if (buttonText === '–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å') {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø–æ–∫—É–ø–∫–∏
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.tab[data-tab="buy"]').classList.add('active');
                    
                    document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
                    document.getElementById('buy-content').classList.add('active');
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
                    document.getElementById('buy-form').scrollIntoView({ behavior: 'smooth' });
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function refreshData() {
            const listingsContainer = document.getElementById('listings-container');
            const requestsContainer = document.getElementById('requests-container');
            const guarantorsContainer = document.getElementById('guarantors-container');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
            listingsContainer.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            requestsContainer.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            guarantorsContainer.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–Ω–æ–≤–æ
            loadData();
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ö–µ–¥–µ—Ä
        const header = document.querySelector('.header');
        const refreshButton = document.createElement('button');
        refreshButton.className = 'button button-secondary';
        refreshButton.textContent = '–û–±–Ω–æ–≤–∏—Ç—å';
        refreshButton.style.padding = '4px 8px';
        refreshButton.style.fontSize = '12px';
        
        refreshButton.addEventListener('click', refreshData);
        header.appendChild(refreshButton);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –±–æ—Ç–∞ Telegram
        window.Telegram.WebApp.onEvent('message', function(event) {
            const message = event.data;
            
            if (message && message.action) {
                switch (message.action) {
                    case 'listing_created':
                        showAlert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ', 'success');
                        refreshData();
                        break;
                    case 'request_created':
                        showAlert('–ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 'success');
                        refreshData();
                        break;
                    case 'error':
                        showAlert(message.error_message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                        break;
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        if (tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
            try {
                const startParam = JSON.parse(decodeURIComponent(tg.initDataUnsafe.start_param));
                
                if (startParam.action === 'show_listing' && startParam.id) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                    // (–∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
                }
                
                if (startParam.action === 'show_request' && startParam.id) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
                    // (–∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ start_param', e);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ü–µ–Ω
        function validatePrice(input) {
            let value = input.value.trim();
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
            value = value.replace(/[^\d]/g, '');
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ
            const numValue = parseInt(value);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω
            if (numValue < 1) {
                input.value = '';
            } else if (numValue > 100000) {
                input.value = '100000';
            } else {
                input.value = numValue.toString();
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª–µ–π —Ü–µ–Ω—ã
        document.getElementById('sell-price').addEventListener('blur', function() {
            validatePrice(this);
        });

        document.getElementById('buy-price').addEventListener('blur', function() {
            validatePrice(this);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        function checkForUpdates() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            setTimeout(() => {
                const hasNewListings = Math.random() > 0.7; // 30% —à–∞–Ω—Å –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
                const hasNewRequests = Math.random() > 0.8; // 20% —à–∞–Ω—Å –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
                
                if (hasNewListings || hasNewRequests) {
                    refreshData();
                    
                    if (hasNewListings) {
                        showAlert('–î–æ—Å—Ç—É–ø–Ω—ã –Ω–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è', 'success');
                    }
                    
                    if (hasNewRequests) {
                        showAlert('–î–æ—Å—Ç—É–ø–Ω—ã –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã', 'success');
                    }
                }
            }, 30000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        setInterval(checkForUpdates, 30000);
    </script>
</body>
</html>